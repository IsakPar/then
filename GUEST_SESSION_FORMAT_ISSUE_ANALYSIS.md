 LML App: Initialized successfully
ğŸ’³ Stripe: Configured with publishable key
ğŸ”‘ StripeAPI.defaultPublishableKey: pk_test_51RXNt54himci0hKNj5DhlhjYlmevPWR28gQrhdX9KULQj69vwV8YdTCbTABXBPnUAiuADWm6uIUKvth7yy45fiP300PRJkwcjL
ğŸ”‘ STPAPIClient.shared.publishableKey: pk_test_51RXNt54himci0hKNj5DhlhjYlmevPWR28gQrhdX9KULQj69vwV8YdTCbTABXBPnUAiuADWm6uIUKvth7yy45fiP300PRJkwcjL
ğŸ” AuthManager: Initialized
load_eligibility_plist: Failed to open /Users/isakparild/Library/Developer/CoreSimulator/Devices/667DC71E-B1CD-4E0D-8702-189FD3A2D35B/data/Containers/Data/Application/5E518F74-ABB6-4CA5-B6C0-C2BDE7E9A82C/private/var/db/eligibilityd/eligibility.plist: No such file or directory(2)
ğŸ” APIClient: Configured JSON decoder with custom date format for milliseconds
ğŸ” AuthManager: Starting authentication check...
â„¹ï¸ No stored auth token found
âœ… Auth check complete: not authenticated
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["return_url": false, "apple_pay_config": false, "appearance": ["usage": false, "corner_radius": false, "border_width": false, "colors": false, "shadow": false, "primary_button": false, "font": false, "embedded_payment_element": ["row": false, "row_style": "flat_with_radio"]], "payment_method_layout": "automatic", "billing_details_collection_configuration": ["email": "automatic", "phone": "automatic", "address": "automatic", "name": "automatic", "attach_defaults": false], "style": 0, "customer": false, "save_payment_method_opt_in_behavior": "automatic", "allows_delayed_payment_methods": false, "default_billing_details": false, "card_brand_acceptance": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
ğŸ­ SeatMapCanvas rendering 0 seats
ğŸ­ Hamilton SeatMapView appeared - loading seats...
ğŸ­ Generating Hamilton hardcoded seat map...
ğŸ”§ Generating hardcoded seats as fallback...
âœ… Generated 502 hardcoded seats across 5 sections
âœ… Generated 502 hardcoded Hamilton seats
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["save_payment_method_opt_in_behavior": "automatic", "appearance": ["border_width": false, "usage": false, "corner_radius": false, "primary_button": false, "embedded_payment_element": ["row": false, "row_style": "flat_with_radio"], "colors": false, "font": false, "shadow": false], "customer": false, "return_url": false, "card_brand_acceptance": false, "default_billing_details": false, "allows_delayed_payment_methods": false, "billing_details_collection_configuration": ["email": "automatic", "attach_defaults": false, "address": "automatic", "name": "automatic", "phone": "automatic"], "apple_pay_config": false, "style": 0, "payment_method_layout": "automatic"]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["customer": false, "billing_details_collection_configuration": ["phone": "automatic", "name": "automatic", "email": "automatic", "address": "automatic", "attach_defaults": false], "appearance": ["shadow": false, "font": false, "embedded_payment_element": ["row": false, "row_style": "flat_with_radio"], "border_width": false, "corner_radius": false, "primary_button": false, "usage": false, "colors": false], "card_brand_acceptance": false, "return_url": false, "payment_method_layout": "automatic", "save_payment_method_opt_in_behavior": "automatic", "allows_delayed_payment_methods": false, "default_billing_details": false, "style": 0, "apple_pay_config": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["save_payment_method_opt_in_behavior": "automatic", "style": 0, "payment_method_layout": "automatic", "return_url": false, "card_brand_acceptance": false, "appearance": ["corner_radius": false, "usage": false, "embedded_payment_element": ["row_style": "flat_with_radio", "row": false], "shadow": false, "primary_button": false, "colors": false, "border_width": false, "font": false], "apple_pay_config": false, "default_billing_details": false, "customer": false, "billing_details_collection_configuration": ["phone": "automatic", "attach_defaults": false, "email": "automatic", "address": "automatic", "name": "automatic"], "allows_delayed_payment_methods": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["style": 0, "return_url": false, "customer": false, "allows_delayed_payment_methods": false, "default_billing_details": false, "billing_details_collection_configuration": ["email": "automatic", "address": "automatic", "attach_defaults": false, "phone": "automatic", "name": "automatic"], "save_payment_method_opt_in_behavior": "automatic", "appearance": ["shadow": false, "colors": false, "corner_radius": false, "primary_button": false, "embedded_payment_element": ["row": false, "row_style": "flat_with_radio"], "border_width": false, "usage": false, "font": false], "payment_method_layout": "automatic", "apple_pay_config": false, "card_brand_acceptance": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["apple_pay_config": false, "allows_delayed_payment_methods": false, "style": 0, "billing_details_collection_configuration": ["email": "automatic", "phone": "automatic", "address": "automatic", "name": "automatic", "attach_defaults": false], "save_payment_method_opt_in_behavior": "automatic", "card_brand_acceptance": false, "customer": false, "appearance": ["primary_button": false, "usage": false, "shadow": false, "embedded_payment_element": ["row_style": "flat_with_radio", "row": false], "corner_radius": false, "border_width": false, "font": false, "colors": false], "return_url": false, "default_billing_details": false, "payment_method_layout": "automatic"]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
load_eligibility_plist: Failed to open /Users/isakparild/Library/Developer/CoreSimulator/Devices/667DC71E-B1CD-4E0D-8702-189FD3A2D35B/data/Containers/Data/Application/5E518F74-ABB6-4CA5-B6C0-C2BDE7E9A82C/private/var/db/eligibilityd/eligibility.plist: No such file or directory(2)
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["style": 0, "return_url": false, "appearance": ["shadow": false, "border_width": false, "corner_radius": false, "usage": false, "colors": false, "primary_button": false, "embedded_payment_element": ["row_style": "flat_with_radio", "row": false], "font": false], "save_payment_method_opt_in_behavior": "automatic", "default_billing_details": false, "apple_pay_config": false, "payment_method_layout": "automatic", "billing_details_collection_configuration": ["name": "automatic", "phone": "automatic", "attach_defaults": false, "address": "automatic", "email": "automatic"], "allows_delayed_payment_methods": false, "card_brand_acceptance": false, "customer": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["appearance": ["colors": false, "corner_radius": false, "primary_button": false, "shadow": false, "usage": false, "border_width": false, "embedded_payment_element": ["row_style": "flat_with_radio", "row": false], "font": false], "apple_pay_config": false, "customer": false, "return_url": false, "style": 0, "allows_delayed_payment_methods": false, "save_payment_method_opt_in_behavior": "automatic", "billing_details_collection_configuration": ["name": "automatic", "address": "automatic", "attach_defaults": false, "email": "automatic", "phone": "automatic"], "card_brand_acceptance": false, "payment_method_layout": "automatic", "default_billing_details": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
load_eligibility_plist: Failed to open /Users/isakparild/Library/Developer/CoreSimulator/Devices/667DC71E-B1CD-4E0D-8702-189FD3A2D35B/data/Containers/Data/Application/5E518F74-ABB6-4CA5-B6C0-C2BDE7E9A82C/private/var/db/eligibilityd/eligibility.plist: No such file or directory(2)
Result accumulator timeout: 0.250000, exceeded.
Result accumulator timeout: 0.250000, exceeded.
Result accumulator timeout: 0.250000, exceeded.
Result accumulator timeout: 0.250000, exceeded.
ğŸ­ Creating guest session via API for: isak.parild@gmail.com
ğŸ” AuthManager: Starting guest session creation process
ğŸ” AuthManager: Calling authService.createGuestSession
ğŸ­ Creating guest session for: isak.parild@gmail.com
ğŸ” AuthService: Starting guest session creation
ğŸ” AuthService: Device info prepared: ["version": "1.0", "platform": "iOS", "device": "iPhone"]
ğŸ” AuthService: Calling apiClient.createGuestSession
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["apple_pay_config": false, "customer": false, "appearance": ["font": false, "embedded_payment_element": ["row": false, "row_style": "flat_with_radio"], "colors": false, "shadow": false, "primary_button": false, "corner_radius": false, "border_width": false, "usage": false], "default_billing_details": false, "style": 0, "card_brand_acceptance": false, "save_payment_method_opt_in_behavior": "automatic", "payment_method_layout": "automatic", "allows_delayed_payment_methods": false, "return_url": false, "billing_details_collection_configuration": ["address": "automatic", "name": "automatic", "email": "automatic", "attach_defaults": false, "phone": "automatic"]]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
ğŸ” RAW API Response Data:
ğŸ“„ Response String: {"user":{"id":"guest_cd71fa4b-8e2c-4f91-8a04-616c044cd489","email":"isak.parild@gmail.com","firstName":null,"lastName":null,"accountType":"guest","authProvider":"guest","isGuest":true,"emailVerified":false,"biometricEnabled":false,"createdAt":"2025-07-23T12:14:25.004Z"},"sessionToken":"guest_session_9690799c-4205-4090-a481-225a8bd64f6b"}
ğŸ“Š Data Length: 339 bytes
ğŸ¯ Attempting to decode to type: GuestResponse
âœ… Successfully decoded response to GuestResponse
âœ… Guest session created successfully
ğŸ” AuthService: Response received from APIClient
ğŸ” Response type: GuestResponse
ğŸ” AuthManager: Received response from API
ğŸ” Response user ID: guest_cd71fa4b-8e2c-4f91-8a04-616c044cd489
ğŸ” Response user email: isak.parild@gmail.com
ğŸ” Response accountType: guest
ğŸ” Response authProvider: guest
ğŸ” Response isGuest: true
ğŸ” Response sessionToken: guest_session_969079...
ğŸ” AuthManager: Created user object successfully
ğŸ” User accountType: guest
ğŸ” User authProvider: guest
âœ… Auth token stored in keychain
âœ… Guest session created successfully via API for: isak.parild@gmail.com
âœ… Guest session created successfully: isak.parild@gmail.com
ğŸ­ Creating guest session via API for: isak.parild@gmail.com
ğŸ” AuthManager: Starting guest session creation process
ğŸ” AuthManager: Calling authService.createGuestSession
ğŸ­ Creating guest session for: isak.parild@gmail.com
ğŸ” AuthService: Starting guest session creation
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["save_payment_method_opt_in_behavior": "automatic", "apple_pay_config": false, "billing_details_collection_configuration": ["attach_defaults": false, "phone": "automatic", "email": "automatic", "address": "automatic", "name": "automatic"], "payment_method_layout": "automatic", "customer": false, "return_url": false, "card_brand_acceptance": false, "style": 0, "appearance": ["colors": false, "corner_radius": false, "primary_button": false, "usage": false, "shadow": false, "border_width": false, "embedded_payment_element": ["row": false, "row_style": "flat_with_radio"], "font": false], "default_billing_details": false, "allows_delayed_payment_methods": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
load_eligibility_plist: Failed to open /Users/isakparild/Library/Developer/CoreSimulator/Devices/667DC71E-B1CD-4E0D-8702-189FD3A2D35B/data/Containers/Data/Application/5E518F74-ABB6-4CA5-B6C0-C2BDE7E9A82C/private/var/db/eligibilityd/eligibility.plist: No such file or directory(2)
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["style": 0, "return_url": false, "billing_details_collection_configuration": ["name": "automatic", "address": "automatic", "attach_defaults": false, "email": "automatic", "phone": "automatic"], "save_payment_method_opt_in_behavior": "automatic", "card_brand_acceptance": false, "payment_method_layout": "automatic", "apple_pay_config": false, "default_billing_details": false, "customer": false, "appearance": ["primary_button": false, "usage": false, "shadow": false, "border_width": false, "corner_radius": false, "font": false, "embedded_payment_element": ["row": false, "row_style": "flat_with_radio"], "colors": false], "allows_delayed_payment_methods": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["style": 0, "return_url": false, "billing_details_collection_configuration": ["phone": "automatic", "attach_defaults": false, "name": "automatic", "email": "automatic", "address": "automatic"], "save_payment_method_opt_in_behavior": "automatic", "card_brand_acceptance": false, "payment_method_layout": "automatic", "apple_pay_config": false, "default_billing_details": false, "customer": false, "appearance": ["primary_button": false, "usage": false, "shadow": false, "border_width": false, "corner_radius": false, "font": false, "embedded_payment_element": ["row_style": "flat_with_radio", "row": false], "colors": false], "allows_delayed_payment_methods": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
ğŸ” AuthService: Device info prepared: ["version": "1.0", "device": "iPhone", "platform": "iOS"]
ğŸ” AuthService: Calling apiClient.createGuestSession
ğŸ” RAW API Response Data:
ğŸ“„ Response String: {"user":{"id":"guest_46ec0b8e-87ff-4a8e-a4c1-5ea990c7a746","email":"isak.parild@gmail.com","firstName":null,"lastName":null,"accountType":"guest","authProvider":"guest","isGuest":true,"emailVerified":false,"biometricEnabled":false,"createdAt":"2025-07-23T12:14:25.260Z"},"sessionToken":"guest_session_610c07e2-44b4-4ec3-836e-04fb3e80c85c"}
ğŸ“Š Data Length: 339 bytes
ğŸ¯ Attempting to decode to type: GuestResponse
âœ… Successfully decoded response to GuestResponse
âœ… Guest session created successfully
ğŸ” AuthService: Response received from APIClient
ğŸ” Response type: GuestResponse
ğŸ” AuthManager: Received response from API
ğŸ” Response user ID: guest_46ec0b8e-87ff-4a8e-a4c1-5ea990c7a746
ğŸ” Response user email: isak.parild@gmail.com
ğŸ” Response accountType: guest
ğŸ” Response authProvider: guest
ğŸ” Response isGuest: true
ğŸ” Response sessionToken: guest_session_610c07...
ğŸ” AuthManager: Created user object successfully
ğŸ” User accountType: guest
ğŸ” User authProvider: guest
âœ… Auth token stored in keychain
âœ… Guest session created successfully via API for: isak.parild@gmail.com
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["appearance": ["embedded_payment_element": ["row": false, "row_style": "flat_with_radio"], "corner_radius": false, "font": false, "usage": false, "shadow": false, "colors": false, "border_width": false, "primary_button": false], "billing_details_collection_configuration": ["phone": "automatic", "name": "automatic", "address": "automatic", "email": "automatic", "attach_defaults": false], "payment_method_layout": "automatic", "save_payment_method_opt_in_behavior": "automatic", "customer": false, "return_url": false, "default_billing_details": false, "style": 0, "apple_pay_config": false, "card_brand_acceptance": false, "allows_delayed_payment_methods": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["customer": false, "return_url": false, "style": 0, "save_payment_method_opt_in_behavior": "automatic", "appearance": ["font": false, "embedded_payment_element": ["row_style": "flat_with_radio", "row": false], "border_width": false, "usage": false, "primary_button": false, "shadow": false, "colors": false, "corner_radius": false], "billing_details_collection_configuration": ["name": "automatic", "email": "automatic", "attach_defaults": false, "address": "automatic", "phone": "automatic"], "card_brand_acceptance": false, "apple_pay_config": false, "default_billing_details": false, "allows_delayed_payment_methods": false, "payment_method_layout": "automatic"]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["allows_delayed_payment_methods": false, "billing_details_collection_configuration": ["attach_defaults": false, "email": "automatic", "name": "automatic", "phone": "automatic", "address": "automatic"], "payment_method_layout": "automatic", "default_billing_details": false, "customer": false, "appearance": ["font": false, "colors": false, "corner_radius": false, "shadow": false, "border_width": false, "primary_button": false, "usage": false, "embedded_payment_element": ["row": false, "row_style": "flat_with_radio"]], "apple_pay_config": false, "return_url": false, "style": 0, "save_payment_method_opt_in_behavior": "automatic", "card_brand_acceptance": false]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
load_eligibility_plist: Failed to open /Users/isakparild/Library/Developer/CoreSimulator/Devices/667DC71E-B1CD-4E0D-8702-189FD3A2D35B/data/Containers/Data/Application/5E518F74-ABB6-4CA5-B6C0-C2BDE7E9A82C/private/var/db/eligibilityd/eligibility.plist: No such file or directory(2)
âŒ Payment intent creation failed: notFound
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["save_payment_method_opt_in_behavior": "automatic", "billing_details_collection_configuration": ["name": "automatic", "phone": "automatic", "attach_defaults": false, "address": "automatic", "email": "automatic"], "return_url": false, "default_billing_details": false, "apple_pay_config": false, "customer": false, "allows_delayed_payment_methods": false, "appearance": ["colors": false, "font": false, "usage": false, "border_width": false, "shadow": false, "primary_button": false, "corner_radius": false, "embedded_payment_element": ["row_style": "flat_with_radio", "row": false]], "card_brand_acceptance": false, "payment_method_layout": "automatic", "style": 0]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
-[RTIInputSystemClient remoteTextInputSessionWithID:performInputOperation:]  perform input operation requires a valid sessionID. inputModality = Keyboard, inputOperation = <null selector>, customInfoType = UIEmojiSearchOperations
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["card_brand_acceptance": false, "payment_method_layout": "automatic", "return_url": false, "default_billing_details": false, "billing_details_collection_configuration": ["name": "automatic", "email": "automatic", "phone": "automatic", "address": "automatic", "attach_defaults": false], "customer": false, "save_payment_method_opt_in_behavior": "automatic", "apple_pay_config": false, "allows_delayed_payment_methods": false, "appearance": ["embedded_payment_element": ["row": false, "row_style": "flat_with_radio"], "usage": false, "font": false, "primary_button": false, "shadow": false, "border_width": false, "corner_radius": false, "colors": false], "style": 0]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
LOG ANALYTICS: mc_complete_init_default - [(key: "pay_var", value: "paymentsheet"), (key: "ocr_type", value: "none"), (key: "mpe_config", value: ["default_billing_details": false, "card_brand_acceptance": false, "customer": false, "apple_pay_config": false, "return_url": false, "style": 0, "allows_delayed_payment_methods": false, "save_payment_method_opt_in_behavior": "automatic", "appearance": ["embedded_payment_element": ["row_style": "flat_with_radio", "row": false], "usage": false, "colors": false, "border_width": false, "primary_button": false, "font": false, "corner_radius": false, "shadow": false], "billing_details_collection_configuration": ["attach_defaults": false, "phone": "automatic", "email": "automatic", "name": "automatic", "address": "automatic"], "payment_method_layout": "automatic"]), (key: "is_decoupled", value: false), (key: "apple_pay_enabled", value: 1), (key: "active_link_session", value: false)]
nw_protocol_socket_set_no_wake_from_sleep [C2.1.1:2] setsockopt SO_NOWAKEFROMSLEEP failed [22: Invalid argument]
nw_protocol_socket_set_no_wake_from_sleep setsockopt SO_NOWAKEFROMSLEEP failed [22: Invalid argument]
nw_protocol_socket_set_no_wake_from_sleep [C2.1.1:2] setsockopt SO_NOWAKEFROMSLEEP failed [22: Invalid argument]
nw_protocol_socket_set_no_wake_from_sleep setsockopt SO_NOWAKEFROMSLEEP failed [22: Invalid argument]# ğŸš¨ Guest Session Format Issue - Comprehensive Analysis Plan

## ğŸ” **Current Status**
- âœ… API successfully creates guest sessions (database insertion works)
- âœ… API returns HTTP 200 status
- âŒ iOS app fails to parse response: "data isn't in the correct format"

## ğŸ¯ **Root Cause Analysis Plan**

### **Phase 1: Compare API Response vs iOS Model**

#### **1.1 Capture Actual API Response**
```bash
# Test current API response format
curl -X POST http://localhost:3001/api/guest-session \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","deviceInfo":{"platform":"iOS","device":"iPhone","version":"1.0"}}' \
  | jq '.' > actual_api_response.json
```

#### **1.2 Document iOS Expected Format**
From `AuthModels.swift`, the iOS app expects:
```swift
struct GuestResponse: Codable {
    let user: User
    let sessionToken: String
}

struct User: Codable {
    let id: String
    let email: String
    let accountType: String        // Must match AccountType enum
    let authProvider: String       // Must match AuthProvider enum  
    let isGuest: Bool
    let emailVerified: Bool
    let biometricEnabled: Bool
    let createdAt: String         // ISO 8601 date string
}
```

#### **1.3 Check Enum Value Mismatches**
The issue is likely in these enum fields:

**AccountType enum values:**
- iOS expects: "guest", "standard", "premium"
- API returns: ?

**AuthProvider enum values:**
- iOS expects: "email", "google", "apple", "guest"
- API returns: ?

### **Phase 2: Data Type Validation**

#### **2.1 Field Type Mismatches**
Check each field type:
- `id`: String âœ“
- `email`: String âœ“
- `accountType`: String (but must match enum)
- `authProvider`: String (but must match enum)
- `isGuest`: Bool (check if returning true/false vs "true"/"false")
- `emailVerified`: Bool (check boolean vs string)
- `biometricEnabled`: Bool (check boolean vs string)
- `createdAt`: String (check ISO format)
- `sessionToken`: String âœ“

#### **2.2 Date Format Issues**
iOS expects ISO 8601 format:
```
"2025-07-23T10:35:52.730Z"
```

### **Phase 3: Response Structure Validation**

#### **3.1 Check Response Wrapper**
Ensure response structure matches exactly:
```json
{
  "user": {
    "id": "string",
    "email": "string",
    "accountType": "guest",
    "authProvider": "guest",
    "isGuest": true,
    "emailVerified": false,
    "biometricEnabled": false,
    "createdAt": "2025-07-23T10:35:52.730Z"
  },
  "sessionToken": "string"
}
```

#### **3.2 Check for Extra Fields**
iOS Codable might fail if there are unexpected fields in the response.

### **Phase 4: Specific Issues to Investigate**

#### **4.1 Boolean Value Format**
**Problem**: JSON boolean vs string boolean
```json
// âœ… Correct (JSON boolean)
"isGuest": true,
"emailVerified": false

// âŒ Wrong (string boolean)
"isGuest": "true",
"emailVerified": "false"
```

#### **4.2 Enum Value Mismatch**
**Problem**: Case sensitivity or different enum values
```json
// âœ… Correct
"accountType": "guest"        // lowercase
"authProvider": "guest"       // lowercase

// âŒ Wrong
"accountType": "Guest"        // uppercase
"authProvider": "GUEST"       // uppercase
"accountType": "GUEST_USER"   // different value
```

#### **4.3 Date Format Issues**
**Problem**: Date format not ISO 8601
```json
// âœ… Correct
"createdAt": "2025-07-23T10:35:52.730Z"

// âŒ Wrong
"createdAt": "2025-07-23 10:35:52"
"createdAt": 1721729752730
"createdAt": "23/07/2025"
```

#### **4.4 Missing Required Fields**
**Problem**: Even though validation passes, iOS model might have different requirements
```json
// Check if ALL these fields are present and correctly typed
{
  "user": {
    "id": "required",
    "email": "required", 
    "accountType": "required",
    "authProvider": "required",
    "isGuest": "required",
    "emailVerified": "required",
    "biometricEnabled": "required",
    "createdAt": "required"
  },
  "sessionToken": "required"
}
```

### **Phase 5: Investigation Steps**

#### **5.1 Compare Working vs Failing**
From logs, some calls succeed, others fail. Compare:
- Working: `isak.parild@gmail.com` (âœ… success)
- Failing: Same email but different format?

#### **5.2 Check iOS Codable Debugging**
Add iOS debugging to see exact parsing error:
```swift
// In iOS app, catch specific JSON parsing errors
do {
    let response = try JSONDecoder().decode(GuestResponse.self, from: data)
} catch let DecodingError.keyNotFound(key, context) {
    print("Missing key: \(key) - \(context)")
} catch let DecodingError.typeMismatch(type, context) {
    print("Type mismatch: \(type) - \(context)")
} catch let DecodingError.valueNotFound(type, context) {
    print("Value not found: \(type) - \(context)")
}
```

#### **5.3 Test with Different Scenarios**
```bash
# Test 1: Minimal request
curl -X POST API_URL -d '{"email":"test@test.com"}'

# Test 2: With device info
curl -X POST API_URL -d '{"email":"test@test.com","deviceInfo":{}}'

# Test 3: Full device info
curl -X POST API_URL -d '{"email":"test@test.com","deviceInfo":{"platform":"iOS","device":"iPhone","version":"1.0"}}'
```

## ğŸ¯ **Most Likely Issues (Priority Order)**

### **1. Boolean Type Mismatch (HIGH PRIORITY)**
API returning string "true"/"false" instead of JSON boolean true/false

### **2. Enum Value Mismatch (HIGH PRIORITY)**
`accountType` or `authProvider` values don't match iOS enum cases exactly

### **3. Date Format Issue (MEDIUM PRIORITY)**
`createdAt` not in proper ISO 8601 format

### **4. Extra Fields in Response (MEDIUM PRIORITY)**
API returning fields that iOS model doesn't expect

### **5. Nested Object Structure (LOW PRIORITY)**
Response structure doesn't match exactly

## ğŸ”§ **Next Steps**

1. **Capture actual API response** and compare with iOS model
2. **Check enum values** in iOS code vs API response
3. **Validate boolean types** (JSON boolean vs string)
4. **Test date format** parsing
5. **Add iOS-side debugging** to get specific parsing errors

## ğŸ“‹ **Testing Checklist**

- [ ] Capture actual API response format
- [ ] Compare with iOS GuestResponse model
- [ ] Check accountType enum values
- [ ] Check authProvider enum values  
- [ ] Validate boolean field types
- [ ] Validate date format
- [ ] Test with minimal request
- [ ] Add iOS debugging for specific error
- [ ] Test with different email addresses
- [ ] Verify no extra fields in response 